{
  "hash": "c441e5f5b4a823c9c205c6c42338224f",
  "result": {
    "markdown": "---\ntitle: \"Day 05\" \ndate: '2022-08-05'\nimage: day5.png\ncategories:\n  - R\n  - Data Viz \n  - sf\n  - ggplot2\ndescription: 'Day 5 form #30 Day Map Challenge'\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::opts_chunk$set(\n  eval = F\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrarian::shelf(\n    osmdata\n    , tidyverse\n    , sf\n    , sysfonts\n    , showtext\n    , cowplot\n)\n\nshowtext_auto()\n\nfont_add_google(\"Quicksand\")\nfont_add_google(\"Fira Sans\")\n\nf1 <- \"Quicksand\"\nf2 <- \"Fira Sans\"\n\ncity_streets <- function(cityname){\n    # border <- opq(bbox=cityname) %>%\n    #     add_osm_feature(key=\"admin_level\", value=\"8\") %>%\n    #     osmdata_sf() %>%\n    #     .$osm_multipolygons\n\n    lines <- opq(bbox=cityname) %>%\n        add_osm_feature(key=\"highway\", value=c(\"primary\", \"secondary\", \"tertiary\", \"residential\")) %>%\n        osmdata_sf() %>%\n        .$osm_lines |>\n        drop_na(lanes) |>\n        dplyr::select(osm_id, name, geometry, highway, lanes) |>\n        mutate(lanes = as.numeric(lanes))\n    # sf_file <- list(border, lines)\n    return(lines)\n}\n\nlima <- city_streets(\"Lima, Peru\")\n\narq <- city_streets(\"Arequipa, Peru\")\n\ntru <- city_streets(\"Trujillo, Peru\")\n\nref_color <-\n    c(\n        \"Primaria\" =  \"#c60b31\"\n        , \"Secundaria\" =\"#5084bf\" #secundario\n        , \"Terciaria\" =\"#d37f1f\" #residencial\n        , \"Residencial\" =\"#cee8dc\"#77ad0a\"\n    )\nnn <- function(n=1, ref = ref_color) {\n    names(ref)[[n]]\n}\n\nplot_t <- function(df){\n    df <-\n        mutate(\n            df,\n            highway = factor(highway, c(\"primary\", 'secondary', \"tertiary\", \"residential\"))\n        )\n    p <-\n        ggplot() +\n        geom_sf(data = df, aes(color = highway, size = lanes)) +\n        scale_color_manual(values = c(\n            \"#c60b31\"\n            , \"#5084bf\" #secundario\n            , \"#d37f1f\" #residencial\n            , \"#cee8dc\"#77ad0a\"\n        )\n        ) +\n        theme_void() +\n        scale_size(range = c(0.1, .6)) +\n        theme(\n            legend.position = \"none\"\n        )\n    return(p)\n}\n\np_lima <- plot_t(lima)\np_arq <- plot_t(arq)\np_tru <- plot_t(tru)\n\ncol_city <-\n    c(\n        \"Lima\" = \"#F8B302\"\n        , \"Arequipa\" = \"#900C3F\"\n        , \"Trujillo\" = \"#FFFFFF\"\n    )\n\n\ntm <- .6\nday5 <-\n    ggdraw(xlim = c(0, 2), ylim = c(0, 1.5)) +\n    draw_label(\n        \"Ciudades más pobladas del Perú\", color = col_city[3], fontface = \"bold\", fontfamily = f1\n        , x = 1, y = 1.4, size = 350\n        ) +\n    draw_line(\n        color = \"#fdf9f5\"\n        , x = c(0, .6)\n        , y = c(1.4, 1.4)\n        , size = 4\n    ) +\n    draw_line(\n        color = \"#fdf9f5\"\n        , x = c(1.4, 2)\n        , y = c(1.4, 1.4)\n        , size = 4\n    ) +\n    draw_label(\n        \"Vías de transito\", color = col_city[3], fontfamily = f1\n        , x = 1, y = 1.34, size = 300\n    ) +\n    draw_plot(p_lima, y = .25, x = -.3, width = 1.7) +\n    draw_plot(p_arq, x = 1, y = .5, width = tm - .1) +\n    draw_plot(p_tru, x = 1, y = -.05, width = tm + .1) +\n    draw_label(\n        names(col_city[1]), color = col_city[1], fontface = \"bold\", fontfamily = f1, size = 280\n        , x = .3, y = .45\n        ) +\n    draw_label(\n        names(col_city[2]), color = col_city[2], fontface = \"bold\", fontfamily = f1, size = 280\n        , x = 1.7, y =  1\n        ) +\n    draw_label(\n        names(col_city[3]), color = col_city[3], fontface = \"bold\", fontfamily = f1, size = 280\n        , x = 1.7, y = .45\n        )  +\n    draw_label(nn(1), color = ref_color[1], size = 230, fontfamily = f2, y = .10, x = .60) +\n    draw_label(nn(2), color = ref_color[2], size = 230, fontfamily = f2, y = .10, x = .85) +\n    draw_label(nn(3), color = ref_color[3], size = 230, fontfamily = f2, y = .10, x = 1.1) +\n    draw_label(nn(4), color = ref_color[4], size = 230, fontfamily = f2, y = .10, x = 1.35) +\n    draw_line(x = c(.530, .660), size = 3, color = ref_color[1], y = .12) +\n    draw_line(x = c(.764, .926), size = 3, color = ref_color[2], y = .12) +\n    draw_line(x = c(1.03, 1.18), size = 3, color = ref_color[3], y = .12) +\n    draw_line(x = c(1.26, 1.43), size = 3, color = ref_color[4], y = .12) +\n    draw_label(\n        \"#30DayMapChallenge | Day 5: Open Street Map\\nData: Wikipedia | VIZ: @JhonKevinFlore1\"\n        , fontfamily = f1\n        , x = 0, y = 0.05\n        , size = 150\n        , color = ref_color[4]\n        , lineheight = .12\n        , hjust = 0\n    ) +\n    theme(\n        # plot.background = element_rect(fill = \"#162447\")\n    )\n\n# day5\nggsave(plot = day5, \"day5.png\", width = 70, height = 50, units = \"cm\", dpi = 700)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}