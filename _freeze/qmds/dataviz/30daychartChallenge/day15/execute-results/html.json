{
  "hash": "0b74dd26e14087ab56c0fb03fb9060c4",
  "result": {
    "markdown": "---\ntitle: \"Day 15\" \ndate: '2022-04-15'\nimage: plots/day15_dcc_22.png\ncategories:\n  - R\n  - Data Viz \n  - ggplot2\n  - Data analysis\n  - BCRP\ndescription: 'Day 15 from #30dataChartChallenge'\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::opts_chunk$set(\n  cache = T\n)\nlibrarian::shelf(\n  tidyverse\n  , PeruData\n  , lubridate\n  # , sysfonts\n  # , showtext\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\n  The 'cran_repo' argument in shelf() was not set, so it will use\n  cran_repo = 'https://cran.r-project.org' by default.\n\n  To avoid this message, set the 'cran_repo' argument to a CRAN\n  mirror URL (see https://cran.r-project.org/mirrors.html) or set\n  'quiet = TRUE'.\n```\n:::\n\n```{.r .cell-code}\nsysfonts::font_add_google(\"Ubuntu\", \"regular\")\n# showtext_auto()\n\n\nmlt <- c(\n  \"https://estadisticas.bcrp.gob.pe/estadisticas/series/diarias/resultados/PD04704XD/html\"\n  , \"https://estadisticas.bcrp.gob.pe/estadisticas/series/diarias/resultados/PD04703XD/html\"\n  , \"https://estadisticas.bcrp.gob.pe/estadisticas/series/diarias/resultados/PD04702XD/html\"\n  , \"https://estadisticas.bcrp.gob.pe/estadisticas/series/diarias/resultados/PD04701XD/html\"\n)\n\nSys.setlocale(\"LC_ALL\", \"Spanish\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in Sys.setlocale(\"LC_ALL\", \"Spanish\"): using locale code page other\nthan 65001 (\"UTF-8\") may cause problems\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"LC_COLLATE=Spanish_Spain.1252;LC_CTYPE=Spanish_Spain.1252;LC_MONETARY=Spanish_Spain.1252;LC_NUMERIC=C;LC_TIME=Spanish_Spain.1252\"\n```\n:::\n\n```{.r .cell-code}\npi <- \n  bcrp_get(mlt)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nGetting data ...\n```\n:::\n\n```{.r .cell-code}\npi |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n# A tibble: 6,941 x 2\n   fecha   cotizaciones_internacionales_oro_londres_us_por_onzas_troy\n   <chr>   <chr>                                                     \n 1 02Ene97 366.10                                                    \n 2 03Ene97 362.40                                                    \n 3 06Ene97 357.70                                                    \n 4 07Ene97 359.10                                                    \n 5 08Ene97 356.00                                                    \n 6 09Ene97 356.60                                                    \n 7 10Ene97 359.25                                                    \n 8 13Ene97 358.90                                                    \n 9 14Ene97 356.90                                                    \n10 15Ene97 354.20                                                    \n# i 6,931 more rows\n\n[[2]]\n# A tibble: 6,941 x 2\n   fecha   cotizaciones_internacionales_zinc_londres_c_us_por_libras\n   <chr>   <chr>                                                    \n 1 02Ene97 46.97                                                    \n 2 03Ene97 47.29                                                    \n 3 06Ene97 47.20                                                    \n 4 07Ene97 47.31                                                    \n 5 08Ene97 47.51                                                    \n 6 09Ene97 47.26                                                    \n 7 10Ene97 47.40                                                    \n 8 13Ene97 47.36                                                    \n 9 14Ene97 48.72                                                    \n10 15Ene97 49.49                                                    \n# i 6,931 more rows\n\n[[3]]\n# A tibble: 6,941 x 2\n   fecha   cotizaciones_internacionales_plata_h_harman_us_por_onzas_troy\n   <chr>   <chr>                                                        \n 1 02Ene97 4.73                                                         \n 2 03Ene97 4.71                                                         \n 3 06Ene97 4.65                                                         \n 4 07Ene97 4.67                                                         \n 5 08Ene97 4.65                                                         \n 6 09Ene97 4.70                                                         \n 7 10Ene97 4.73                                                         \n 8 13Ene97 4.69                                                         \n 9 14Ene97 4.71                                                         \n10 15Ene97 4.67                                                         \n# i 6,931 more rows\n\n[[4]]\n# A tibble: 6,941 x 2\n   fecha   cotizaciones_internacionales_cobre_londres_c_us_por_libras\n   <chr>   <chr>                                                     \n 1 02Ene97 102.29                                                    \n 2 03Ene97 104.46                                                    \n 3 06Ene97 104.55                                                    \n 4 07Ene97 105.05                                                    \n 5 08Ene97 108.05                                                    \n 6 09Ene97 107.41                                                    \n 7 10Ene97 109.32                                                    \n 8 13Ene97 111.18                                                    \n 9 14Ene97 111.95                                                    \n10 15Ene97 109.09                                                    \n# i 6,931 more rows\n```\n:::\n:::\n\n::: {.cell hash='day15_cache/html/unnamed-chunk-2_141832f1fff9d31af580476027981263'}\n\n```{.r .cell-code}\nlast_p <- \n  pi |> \n  reduce(left_join) |> \n  slice(n():(n() - 300)) |> \n  mutate(\n    fecha1 = str_to_lower(fecha)\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nJoining with `by = join_by(fecha)`\nJoining with `by = join_by(fecha)`\nJoining with `by = join_by(fecha)`\n```\n:::\n\n```{.r .cell-code}\nnn <- \n  last_p |> \n  mutate(\n    fecha = str_replace_all(fecha, \"Set\", \"Sep\")\n    , fecha1 = str_to_lower(fecha)\n    , fecha2 = paste(str_sub(fecha1, 1, 5), \".\", str_sub(fecha1, 6, -1), sep = \"\")\n    , fecha = dmy(fecha2)\n  ) |> \n  # filter(is.na(fecha))\n  dplyr::select(1:5) |> \n  rename(\n    oro = 2\n    , zinc = 3\n    , plata = 4\n    , cobre = 5\n  ) |> \n  pivot_longer(!fecha) |> \n  mutate(\n    value = as.numeric(value)\n  )\n\nmi_cl <- \n  c(\n    \"#ffd700\"\n    , \"#bac4c8\"\n    , \"#b87333\"\n    , \"#5b7582\"\n  )\nnn |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 x 3\n  fecha      name   value\n  <date>     <chr>  <dbl>\n1 2023-08-10 oro   1916. \n2 2023-08-10 zinc   112. \n3 2023-08-10 plata   22.7\n4 2023-08-10 cobre  382. \n5 2023-08-09 oro   1914. \n6 2023-08-09 zinc   113. \n```\n:::\n:::\n\n::: {.cell hash='day15_cache/html/unnamed-chunk-3_1ce52e3b17998d66dba0707da40f4c37'}\n\n```{.r .cell-code}\nnn |> \n  mutate(\n    mi = factor(str_to_sentence(name), c(\"Oro\", \"Plata\", \"Cobre\", \"Zinc\"))\n  ) |> \n  # filter(name == 'oro') |> \n  ggplot() +\n  aes(fecha, value, group = mi, color = mi) +\n  # ggalt::geom_xspline() +\n  geom_line(size = 1, show.legend = F) +\n  facet_wrap(~mi, scales = \"free_y\") +\n  scale_x_date(date_breaks = \"18 weeks\") +\n  labs(\n    x = \"\", y = \"\"\n    , title = \"Commodities\"\n    , subtitle = \"Cottizaciones internacionales ($)\"\n    , caption = \"#30DayChartChallenge | Data: BCRP \\nDay15: Multivariable | Viz: @JhonKevinFlore1\"\n    ) +\n  scale_color_manual(\n    values = mi_cl\n  ) +\n  scale_y_continuous(labels = scales::dollar) +\n  theme_minimal()+\n  theme(\n    panel.background = element_rect(\"white\", color = NA)\n    , plot.background = element_rect(\"white\")\n    , panel.grid.minor = element_blank()\n    , plot.margin = margin(.3, 1, .1, .3, \"cm\")\n    , axis.line = element_line()\n    , axis.text.x = element_text(hjust = .5, angle = 12)\n    , plot.caption = element_text(hjust = .5)\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\ni Please use `linewidth` instead.\n```\n:::\n\n::: {.cell-output-display}\n![](day15_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='day15_cache/html/unnamed-chunk-4_e8ac1fa4dcba7a2607d9fba5f8c299cf'}\n\n```{.r .cell-code}\nggsave(\n  'plots/day15_dcc_22.png'\n  , height = 8\n  , width = 12\n  , dpi = 320\n)\n```\n:::\n\n::: {.cell hash='day15_cache/html/unnamed-chunk-5_0aa16d5a89a0252cde90dcf267c8f68e'}\n\n```{.r .cell-code}\nknitr::include_graphics('plots/day15_dcc_22.png')\n```\n\n::: {.cell-output-display}\n![](plots/day15_dcc_22.png){width=1920}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}