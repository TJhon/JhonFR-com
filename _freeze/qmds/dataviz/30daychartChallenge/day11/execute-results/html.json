{
  "hash": "8eccbc673ff75807a039498d472aaa9c",
  "result": {
    "markdown": "---\ntitle: \"Day 11\" \ndate: '2022-04-11'\nimage: plots/day11_dcc_22.png\ncategories:\n  - R\n  - Data Viz \n  - ggplot2\n  - Data analysis\n  - COES\ndescription: 'Day 11 from #30dataChartChallenge'\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrarian::shelf(\n  tidyverse\n  , PeruData\n  , lubridate\n  , ggalt\n  , cowplot\n)\n\ntype_e <- c(\"Solar\", \"Eólica\", \"Termoeléctrica\" , \"Hidroeléctrica\")\nnames(type_e) <- c(\n  \"#fcad02\"\n  , \"#02a5e5\"\n  , \"#e54202\"\n  , \"#203387\"\n  )\n\ngen <-\n  PeruData::coes(\"generacion\", start = \"2021-01-01\", end = \"2021-12-31\") |> \n  select(!2:3) |> \n  mutate(\n    fecha = dmy(fecha)\n    , tipo = str_to_sentence(tipo_generacion)\n    , sem = week(fecha)\n  ) |> \n  select(!1:2) |> \n  group_by(sem, tipo) |> \n  summarise(total = sum(total)) |> \n  ungroup() |> \n  mutate(\n    tipo = factor(tipo, type_e)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nm_c <- \"gray\"\n\nmain_theme <- function(...){\n  \n  \n  # t <- \n    theme_void() +\n    theme(\n      panel.grid.minor = element_blank()\n      , panel.grid.major.x = element_blank()\n      , axis.text = element_blank()\n      , panel.background = element_blank()\n      , plot.background = element_blank()\n      , legend.position = \"none\"\n    ) +\n    theme(...)\n  # t\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- \n  gen |> \n  ggplot() +\n  aes(sem, total, group = tipo, fill = tipo) +\n  geom_col(\n    # position = \"dodge\"\n  ) +\n  coord_polar() +\n  scale_fill_manual(\n    values = names(type_e)\n  ) +\n  main_theme(\n    panel.grid.major.x = element_line(color = \"grey60\")\n    , axis.text.x = element_text(color = \"black\", hjust = 1)\n  )\n\np2 <- \n  gen |> \n  pivot_wider(names_from = tipo, values_from = total) |> \n  mutate(\n    across(2:5, lag)\n  ) |> \n  pivot_longer(!sem, names_to = \"tipo\") |> \n  left_join(gen) |> \n  drop_na() |> \n  mutate(\n    cre = ((total - value) / value ) * 100\n    , tipo = factor(tipo, c(\"Eólica\", \"Solar\",\"Hidroeléctrica\" ,\"Termoeléctrica\" ))\n  ) |> \n  ggplot() +\n  aes(sem, cre, group = tipo, color = tipo) +\n  geom_hline(yintercept = 0, color = m_c, linetype = \"dashed\") +\n  geom_hline(yintercept = -40, color = m_c, linetype = \"dashed\") +\n  geom_hline(yintercept = 40, color = m_c, linetype = \"dashed\") +\n  geom_vline(xintercept = 1, color = m_c, linetype = 4) +\n  geom_xspline(size = 1) +\n  ylim(-50, 50) +\n  scale_x_continuous(breaks = seq(0, 50, by = 10)) +\n  annotate(\"text\", x = rep(1, 3), y = c(3, -37, 43), label = c(\"0%\", \"-40%\", \"40%\"), vjust = 1) +\n  coord_polar(start = 0) +\n  scale_color_manual(values = names(type_e)) +\n  main_theme(\n    panel.grid.major.x = element_line(color = \"grey60\")\n    , axis.text.x = element_text(color = \"black\", hjust = 1)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlbl <- function(n = 1, x = 1.06, y = NULL, z = 18\n    ){\n  draw_label(\n    label = type_e[n]\n    , color = names(type_e)[n]\n    , y = y\n    , x = x\n    , size = z\n    , hjust = .5\n    , fontface = \"bold\"\n  )\n}\n  \np <- \n  ggdraw(xlim = c(0, 2), ylim = c(0, 1.2)) +\n  draw_plot(p1) +\n  draw_plot(p2, x = 1.1) +\n  draw_label(\n    \"Perú - Generación eléctrica (semanal)\"\n    , x = 1.1\n    , y = 1.1\n    , size = 30\n    , color = \"#114468\"\n    , fontface = \"bold\"\n  ) +\n  draw_label(\n    \"Por tipo de generación\"\n    , x = 1.1\n    , y = 1\n    , size = 27\n    , color = \"#277f68\"\n  ) +\n  lbl(1, y = .7) +\n  lbl(2, y = .6) +\n  lbl(3, y = .5) + \n  lbl(4, y = .4) +\n  theme(\n    plot.background = element_rect(\n      \"white\", \n      color = NA\n    )\n  ) +\n  draw_label(\n    \"Generación promedio\"\n    , x = .1\n    , y = .97\n    , size = 23\n    , hjust = 0\n    , color = \"grey50\"\n  ) +\n  draw_label(\n    \"Variación porcentual (%)\"\n    , x = 1.95\n    , y = .97\n    , size = 23\n    , hjust = 1\n    , color = \"gray40\"\n  ) +\n  draw_label(\n    \"#30DayChartChallenge | Data: COES - Perú | Day10: Circular | Viz: @JhonKevinFlore1\"\n    , x = 1\n    , y = .05\n    , color = \"darkgrey\"\n  ) +\n  draw_image(\n    \"https://raw.githubusercontent.com/TJhon/PeruData/main/figs/PeruData-night.png\"\n    , x = .96\n    , y = -.28\n    , width = .2\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\n  'plots/day11_dcc_22.png'\n  , plot = p\n  , height = 8\n  , width = 16\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::include_graphics('https://raw.githubusercontent.com/TJhon/30DayChartChallenge/main/Plots/day11.png')\n```\n\n::: {.cell-output-display}\n![](https://raw.githubusercontent.com/TJhon/30DayChartChallenge/main/Plots/day11.png)\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}