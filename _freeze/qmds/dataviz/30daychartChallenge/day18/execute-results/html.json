{
  "hash": "5317170b28203a674de6f654a7938c15",
  "result": {
    "markdown": "---\ntitle: \"Day 18\" \ndate: '2022-04-18'\nimage: plots/day18_dcc_22.png\ncategories:\n  - R\n  - Data Viz \n  - ggplot2\n  - Data analysis\ndescription: 'Day 18 from #30dataChartChallenge'\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrarian::shelf(\n  tidyverse\n  , rvest\n  , ggtext\n)\n\n\noecd <- #\n  read_csv(here::here(\"data\", \"oecd\", \"healt_pubord.csv\")) |> \n  janitor::clean_names() |> \n  select(!c(flag_codes, measure, indicator, frequency))\n\n\n\n# cc <- read_csv(\"https://gist.githubusercontent.com/tadast/8827699/raw/f5cac3d42d16b78348610fc4ec301e9234f82821/countries_codes_and_coordinates.csv\") |>\n#   janitor::clean_names() |>\n#   select(1, 2) |>\n#   rename(code = 2)\n\ncc1 <- \"https://wits.worldbank.org/wits/wits/witshelp/content/codes/country_codes.htm\"\n\ncc <- \n  rvest::read_html(cc1) |> \n  rvest::html_table() %>%\n  .[[1]] |> \n  rename(\n    country = 1, code = 2, code_c = 3\n  ) |> \n  slice(3:n())\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\necd_all <-\n  oecd |> \n  mutate(subject = PeruData::tidy_text(subject)) |> \n  left_join(cc, by = c(\"location\" = 'code')) |> \n  # filter(is.na(country)) |> \n  # pull(location) |> \n  # unique()\n  \n  pivot_wider(names_from = subject, values_from = value) |>\n  filter(time == 2019) |> \n  mutate(\n    country = case_when(\n      location == \"OEU\" ~ \"OECD - Europe\"\n      , location == \"OECD\" ~ \"OECD - Total\"\n      , location == \"OAVG\" ~ \"OECD - Average\"\n      , location == \"ROU\" ~ \"Romania\"\n      , T ~ country\n    )\n    , country1 = ifelse(str_detect(country, \"OE\"), paste0('<span style=\"color:#51719c\">**', country, \"**</span>\"), country)\n    , total = health + pubord\n    # , diff = \n  ) |> \n  dplyr::select(country, health:total) |> \n  pivot_longer(c(health:pubord)) |>\n  mutate(\n    name = ifelse(name == \"health\", \"Health\", \"Public order\\nand safety\")\n    , country = fct_reorder(country, total)\n    , country1 = fct_reorder(country1, total)\n    , value = value / 100\n    )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\noecd_mark <- \n  filter(oecd_all, str_detect(country, \"OE\")) \n  \noecd_cl <- \"#0e3a72\"\ns_l <- 1.1\noecd_all |> \n  ggplot() +\n  geom_line(aes(group = country1), color = \"grey\", size = s_l, alpha = .6) +\n  geom_line(data = oecd_mark, aes(group = country1), color = oecd_cl, size = s_l, alpha = .7) +\n  geom_segment(\n    size = .7, alpha = .2, linetype = \"dashed\"\n    ,data = oecd_mark, aes(x = 0, xend = value, y = country1, yend = country1), color = oecd_cl) +\n  # geom_point(data = oecd_mark, color = \"yellow\") +\n  geom_point(size = 2.4) +\n  aes(value, country1, shape = name, color = name) +\n  scale_shape_manual(values = c(18, 17)) +\n  scale_color_manual(values = c(\"#ff7d01\", \"#51719c\")) +\n  scale_x_continuous(labels = scales::percent, breaks = seq(0, .3, by = .06), limits = c(0, .31)) +\n  theme_bw() +\n  labs(\n    x = \"\", y = \"\"\n    , color = \"\"\n    , shape = \"\"\n    , title = '<span style=\"color:#6c97b1\">**OECD 2019**</span>: Central government spending'\n    , caption = \"#30DayChartChallenge | Data: OECD\\nDay18: OECD | Viz: @JhonKevinFlore1\"\n    ) +\n    # title = 'Per√∫ - <span style=\"color:#0e23af\">**INCORE**</span>'\n  guides(shape = guide_legend(override.aes = list(size = 5))) +\n  theme(\n    legend.position = c(.7, .5)\n    , panel.grid = element_blank()\n    , panel.grid.major.x = element_line(linetype = 2, color = \"grey70\", size = .2)\n    , legend.background = element_blank()\n    , legend.text = element_text(size = 9)\n    , plot.title = element_markdown(hjust = -.4)\n    , plot.caption = element_text(hjust = .5, color = \"gray35\")\n    , axis.text.y = element_markdown()\n    , plot.background = element_rect(\"#f7f6ef\")\n    # , legend.key.width = unit(22, \"mm\")\n    # , \n    # , legend.\n    # , legend.key.size = unit(42, \"mm\")\n  ) \n\nggsave(\n  'plots/day18_dcc_22.png'\n)  \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::include_graphics('plots/day18_dcc_22.png')\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}