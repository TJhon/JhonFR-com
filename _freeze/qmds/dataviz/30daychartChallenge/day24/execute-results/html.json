{
  "hash": "383d87ebde202a4aa1ea18716ffc65e5",
  "result": {
    "markdown": "---\ntitle: \"Day 24\" \ndate: '2022-04-24'\nimage: plots/day24_dcc_22.gif\ncategories:\n  - Data Viz \n  - ggplot2\n  - Data analysis\ndescription: 'Day 24 from #30dataChartChallenge'\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::include_graphics('plots/day24_dcc_22.png')\n```\n\n::: {.cell-output-display}\n![](plots/day24_dcc_22.png){width=1800}\n:::\n:::\n\n\n## Code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrarian::shelf(\n  tidyverse\n  , lubridate\n  , PeruData\n  , ggtext\n)\n\nrp <- \n  c(\n    \"https://estadisticas.bcrp.gob.pe/estadisticas/series/mensuales/resultados/PN01136XM/html\"\n    , \"https://estadisticas.bcrp.gob.pe/estadisticas/series/mensuales/resultados/PN01135XM/html\"\n    , \"https://estadisticas.bcrp.gob.pe/estadisticas/series/mensuales/resultados/PN01134XM/html\"\n    , \"https://estadisticas.bcrp.gob.pe/estadisticas/series/mensuales/resultados/PN01133XM/html\"\n    , \"https://estadisticas.bcrp.gob.pe/estadisticas/series/mensuales/resultados/PN01132XM/html\"\n    , \"https://estadisticas.bcrp.gob.pe/estadisticas/series/mensuales/resultados/PN01131XM/html\"\n    , \"https://estadisticas.bcrp.gob.pe/estadisticas/series/mensuales/resultados/PN01130XM/html\"\n    , \"https://estadisticas.bcrp.gob.pe/estadisticas/series/mensuales/resultados/PN01129XM/html\"\n    , \"https://estadisticas.bcrp.gob.pe/estadisticas/series/mensuales/resultados/PN01137XM/html\"\n    )\n\nrp_1 <- \n  bcrp_get(rp)\n# glimpse(rp_1[[1]])\n\nbcrp_clean <- function(.bcrp_data){\n  Sys.setlocale(\"LC_ALL\", \"Spanish\")\n  id = str_sub(names(.bcrp_data)[2], -10, -1)\n  .bcrp_data |> \n    rename(f = 1, rp = 2) |> \n    mutate(\n      f = str_replace_all(f, \"Set\", \"Sep\") |> \n        str_to_lower()\n      , f = paste(\"01.\", str_sub(f, 1, 3), \".\", str_sub(f, -2, -1), sep = \"\") |> \n        lubridate::dmy()\n      , rp = as.numeric(rp)\n    ) |> \n    add_column(.id = id)\n}\n\n\nrp_latam <- \n  rp_1 |> \n  map_df(bcrp_clean) |> \n  filter(str_detect(.id, \"peru|brasil|chile|ca\"), lubridate::year(f) > 2019) |> \n  mutate(.id = case_when(\n    str_detect(.id, \"peru\") ~ \"Perú\"\n    , str_detect(.id, \"chile\") ~ \"Chile\"\n    , str_detect(.id, \"brasil\") ~ \"Brasil\"\n    , T ~ \"Paises latinoamericanos\"\n    )\n    , .id = fct_reorder2(.id, f, rp)\n  ) \n\n# levels(rp_latam$.id)\ntheme_ft <- function(...) {\n  text_color <- \"#68625D\"\n  color_cases <- \"#71C8E4\"\n  color_cases_text <- \"#258BC3\"\n  color_deaths <- \"#CE3240\" \n    theme_minimal(base_family = \"Outfit Medium\", base_size = 16) + \n      theme(\n        plot.background = element_rect(color = NA, fill = \"#FFF1E5\"),\n        panel.background = element_rect(color = NA, fill = NA),\n        panel.grid = element_blank(),\n        panel.grid.major.y = element_line(color = \"#E3DACE\", size = 0.3),\n        text = element_text(color = text_color, lineheight = 1.3),\n        plot.title = element_textbox(color = \"#040000\", family = \"Outfit Medium\", \n                                     face = \"plain\", size = 20, width = 1),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_markdown(family = \"Outfit Medium\"),\n        plot.caption = element_markdown(\n          family = \"Outfit\", hjust = 1, size = 11.5, color = \"#5E5751\"),\n        plot.caption.position = \"plot\",\n        axis.title = element_blank(),\n        axis.text.x = element_text(hjust = 0, color = text_color, size = 14),\n        axis.text.y.left = element_markdown(family = \"Outfit Medium\"),\n        axis.text.y.right = element_markdown(family = \"Outfit Medium\"),\n        axis.ticks.x = element_line(size = 0.3),\n        axis.ticks.length.x = unit(1.8, \"mm\"),                     \n        plot.margin = margin(t = 12, b = 6, l = 7, r = 15, \"mm\"),\n        strip.text = element_blank(),   # remove default facet titles\n        ...\n      )\n  }  \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nclrs <- c(\n  \"#056c8d\"\n  , \"#009c3b\"\n  , \"#e63d31\"\n  , \"#0039A6\"\n)\nnames(clrs) <- levels(rp_latam$.id)\n\nlb_a <- function(y, z){\n  annotate(\n    \"text\"\n    , x = as_date(\"2022-03-15\")\n    , y = y\n    , size = 5\n    , label = names(clrs)[z]\n    , color = clrs[z]\n    , hjust = 1\n  )\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np <- rp_latam |> \n  # names()\n  ggplot() +\n  aes(f, rp, group = .id, color = .id) +\n  geom_point(data = filter(rp_latam, f == max(f)), aes(f, rp, color = .id), shape = 17, size = 4) +\n  ggalt::geom_xspline(size = 2, alpha = .8) +\n  scale_color_manual(\n    values = clrs \n  ) +\n  labs(\n    x = \"\", y = \"\", \n    title = \"Latinoamerica: Riesgo país\"\n    , subtitle = \"Diferencial de rendimientos del índice de bonos de mercados emergentes\"\n    , caption = \"<br/>Data: Banco de Reserva del Perú<br/>\nVisualización: Jhon Flores (@JhonKevinFlore1 - Twitter)\"\n    ) +\n  scale_x_date(date_breaks = \"7 months\", date_labels = \"%B %Y\") +\n  scale_y_continuous(breaks = seq(150, 800, by = 250)) +\n  lb_a(450, 1) +\n  lb_a(290, 2) +\n  lb_a(220, 3) +\n  lb_a(150, 4) +\n  theme_ft(\n    legend.position = \"none\"\n  ) \n\n\nggsave(\n  'plots/day24_dcc_22.png'\n  , plot = p\n  , width = 12\n  , height = 8\n  )\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}