{
  "hash": "f7184232b8f27680d5d01674003b8e16",
  "result": {
    "markdown": "---\ntitle: \"Day 03\" \ndate: '2022-04-03'\nimage: plots/day3_dcc_22.png\ncategories:\n  - R\n  - Data Viz \n  - IGP\n  - ggplot2\n  - Data analysis\ndescription: 'Day 3 form #30datChartChallenge'\n---\n\n::: {.cell}\n\n```{.r .cell-code}\np_name = 'plots/day3_dcc_22.png'\nknitr::opts_chunk$set(\n  warning = F\n)\nlibrarian::shelf(\n  tidyverse\n  , PeruData\n  , gganimate\n  , lubridate\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\n  The 'cran_repo' argument in shelf() was not set, so it will use\n  cran_repo = 'https://cran.r-project.org' by default.\n\n  To avoid this message, set the 'cran_repo' argument to a CRAN\n  mirror URL (see https://cran.r-project.org/mirrors.html) or set\n  'quiet = TRUE'.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\n  These packages will be installed:\n\n  'gganimate'\n\n  It may take some time.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nalso installing the dependency 'tweenr'\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\npackage 'tweenr' successfully unpacked and MD5 sums checked\npackage 'gganimate' successfully unpacked and MD5 sums checked\n\nThe downloaded binary packages are in\n\tC:\\Users\\Jhon\\AppData\\Local\\Temp\\RtmpE333kV\\downloaded_packages\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'gganimate' was built under R version 4.3.1\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\neq <- \n  PeruData::igp |> \n  distinct() |> \n  select(!c(lat, lon, hour, intensi_km)) |> \n  mutate(\n    anio = year(date)\n    , mes = month(date)\n  ) |> \n  group_by(anio, mes, alert) |> \n  summarise(promedio = mean(magn)) |> \n  ungroup() |> \n  mutate(date = ymd(paste(anio, mes, \"01\", sep = \"/\"))) |> \n  select(!1:2) |> \n  drop_na() |> \n  mutate(\n    alert = factor(alert, c(\"Red\", \"Yellow\", \"Green\"))\n    , alerta_name = case_when(\n      alert == \"Red\" ~ 'Alerta \"Roja\"'\n      , alert == \"Yellow\" ~ 'Alerta \"Ararilla\"'\n      , T ~ 'Alerta \"Verde\"'\n    ) |> \n      factor(c('Alerta \"Roja\"', 'Alerta \"Ararilla\"', 'Alerta \"Verde\"'))\n  ) |> \n  filter(year(date) < 2023) |> \n  with_groups(\n    alert, mutate, mid = mean(promedio, na.rm = T)\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'anio', 'mes'. You can override using the\n`.groups` argument.\n```\n:::\n\n```{.r .cell-code}\neq |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  alert  promedio date       alerta_name             mid\n  <fct>     <dbl> <date>     <fct>                 <dbl>\n1 Red        6.97 1960-01-01 \"Alerta \\\"Roja\\\"\"      6.47\n2 Yellow     5.75 1960-01-01 \"Alerta \\\"Ararilla\\\"\"  4.91\n3 Yellow     5.6  1960-02-01 \"Alerta \\\"Ararilla\\\"\"  4.91\n4 Red        6.2  1960-03-01 \"Alerta \\\"Roja\\\"\"      6.47\n5 Red        6.1  1960-04-01 \"Alerta \\\"Roja\\\"\"      6.47\n6 Yellow     5.4  1960-05-01 \"Alerta \\\"Ararilla\\\"\"  4.91\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npal <- c(\n  \"#C20008\" \n  , \"#FFB400\"\n  # , \"#595A52\"  \n  # , \"#13AFEF\"\n  , \"#006320\"\n)\neq |> \n  ggplot() +\n  geom_point(size = 1) +\n  aes(date, promedio, color = alert) +\n  geom_step(direction = \"vh\") +\n  geom_hline(aes(yintercept = mid, color = alert), linetype = \"dashed\") +\n  facet_wrap(~alerta_name, scales = \"free_y\", ncol = 1) +\n  labs(\n    x = \"\", y = \"\"\n    , title = \"Terremotos/Sismos en el Perú\"\n    , subtitle = \"Promedio de la magnitud de los terremotos segun su clasificación\"\n    , caption = \"Data: IGP - Peru | Viz: @JhonKevinFlore1 | #30DayChartChallenge | Day3: Historical\"\n    \n    ) +\n  scale_color_manual(\n    values = pal\n  ) + \n  scale_x_date(\n    date_labels = \"%m - %Y\", date_breaks = \"2 years\"\n    , limits = as.Date(c('1958-05-01','2023-01-01'))\n    )  +\n  \n  theme(\n    axis.text.x = element_text(angle = 60, vjust = .1, hjust = .5, size = 40)\n    , legend.position = \"none\"\n    , panel.grid.minor = element_blank()\n    , panel.grid.major.x = element_line(size = .5, color = \"grey70\", linetype = \"dotted\")\n    , text = element_text(\n      # family = \"Ubuntu\",\n      face = 'bold',\n      colour = \"#004D40\",\n      size = 40\n    ),\n    plot.background = element_rect(fill = \"white\", color = NA),\n    panel.background = element_rect(fill = \"white\", color = NA), \n    \n    plot.title = element_text(\n      hjust = 0.5,\n      size = 80,\n      margin = margin(10, 0, 0, 0),\n      color = \"#c00000\"\n    ),\n    plot.subtitle = element_text(\n      hjust = 0.5,\n      size = 70,\n      margin = margin(10, 0, 0, 0),\n      color = \"grey40\"\n    ),\n    plot.caption = element_text(\n      hjust = .5,\n      margin = margin(20, 0, 2, 0),\n      color = \"grey50\"\n      , lineheight = .7\n      , size = 20\n    ),\n    plot.margin = margin(0, 1, 1, 0, unit = \"cm\")\n    , strip.background = element_blank()\n    , strip.background.x = element_blank()\n    , axis.line.x.bottom = element_line(linetype = \"solid\", arrow = grid::arrow(length = unit(0.3, \"cm\"), \n                                                                                ends = \"last\", type = \"closed\"))\n    , axis.line.y.left = element_line(linetype = \"solid\")\n  )\n```\n\n::: {.cell-output-display}\n![](day3_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\n  p_name\n  , width = 15 \n  , height = 8\n)\nknitr::include_graphics(p_name)\n```\n\n::: {.cell-output-display}\n![](plots/day3_dcc_22.png){width=2250}\n:::\n:::\n",
    "supporting": [
      "day3_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}