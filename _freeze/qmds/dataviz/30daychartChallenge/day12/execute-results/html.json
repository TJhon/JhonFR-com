{
  "hash": "7b507fc90f9a4053ae644047d8589c34",
  "result": {
    "markdown": "---\ntitle: \"Day 12\" \ndate: '2022-04-12'\nimage: plots/day12_dcc_22.png\ncategories:\n  - R\n  - Data Viz \n  - ggplot2\n  - Data analysis\ndescription: 'Day 12 from #30dataChartChallenge'\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrarian::shelf(\n  tidyverse\n  , sf\n  , PeruData\n  , cowplot\n)\n\n\nPeruData::mef_ppr(\n    \"2021\"\n    , '.xlsx'\n    , to = \"data/peru-opendata/ppr-2021.xlsx\"\n    ) \n# fs::dir_tree(\"data\")\nppr <- \n  readxl::read_xlsx(\n    here::here(\n      \"data\" \n      , \"peru-opendata\"\n      , \"ppr-2021.xlsx\"\n    )\n    , range = \"A4:R1196\"\n  ) |> \n  janitor::clean_names()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nppr_t <-\n  ppr |> \n  select(\n    gl = gobiernos_locales\n    , avance = avance_percent\n  ) |> \n  mutate(\n    \n    ubigeo = str_sub(gl, 1, 6)\n  ) |> \n  filter(str_detect(gl, \"PROVINCIAL\")) |> \n  left_join(ubigeo_peru) |> \n  # select(avance, ubigeo) |> \n  # left_join(PeruData::ubigeo_peru) |> \n  select(depa, prov, dist, avance) |> \n  left_join(map_peru_prov) \n\n\n\n\nno_b <- \n  ppr_t |> \n  filter(avance < 70) |> \n  count(depa) |> \n  arrange(-n) |> \n  slice(1:10) |> \n  mutate(\n    depa = fct_reorder(str_to_sentence(depa), n)\n    , n = as.integer(n)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- \n  no_b |> \n  ggplot() +\n  aes(n, depa, group = depa, label = depa) +\n  scale_x_continuous(breaks = seq(0, 12, by = 3)) +\n  geom_point(\n    size = 9\n    , color = \"#E5121A\"\n    ) +\n  geom_segment(\n    aes(\n      x = 0\n      , xend = n\n      , yend = depa\n    )\n    , size = 6\n    , color = \"#E5121A\"\n    ) +\n  geom_text(\n    aes(x = 2.8)\n    # , nudge_x = 1.2\n    , color = \"grey80\"\n    , hjust = 1\n    , fontface = \"bold\"\n    , size = 3.5\n  ) +\n  labs(\n    title = \"Las regiones con más municipales provinciales\\ncon ejecución del presupuesto publico menor al 70%\"\n  ) +\n  geom_point(size = 4, color = 'gray90') +\n  theme_void() +\n  theme(\n    panel.grid = element_blank()\n    , axis.line.x.bottom = element_line(color = \"grey30\")\n    , axis.text.x = element_text(color = \"grey20\")\n    , plot.margin = margin(1, 1, 1, 1, \"cm\")\n    , panel.grid.major.x = element_line(color = \"grey60\", linetype = \"dashed\")\n    , plot.background = element_blank()\n    , panel.background = element_blank()\n    , plot.title = element_text()\n  )\n\navance <- colorRampPalette(c(\"#E5121A\", \"#b3c6d6\", \"#01396b\"))\np2 <- \n  ppr_t |> \n  ggplot() +\n  # geom_sf(data = map_peru_depa, fill = \"#E5121A\") +\n  geom_sf(aes(geometry = geometry, fill = avance)) +\n  geom_sf(data = map_peru_depa, fill = NA, color  = \"grey\") +\n  geom_sf(data = map_peru_peru, fill = NA, color = \"#01396b\") +\n  labs(\n    # title = \"Ejecución Presupuestal\"\n    fill = \"(%)\"\n  ) +\n  scale_fill_gradientn(\n    colours = avance(3)\n  ) +\n  guides(\n    fill = guide_colorbar(\n      ticks.colour = \"grey10\"\n      , title.position = \"top\"\n      , title.hjust = .5\n      , direction = \"horizontal\"\n    )\n  ) +\n  theme_void() +\n  theme(\n    legend.position = c(.2, .3)\n    , legend.direction = \"horizontal\"\n    # , legend.title = element_text(hjust = .5)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggdraw(x = c(0, 9), y = c(0, 1.2)) +\n  draw_plot(p1, width = 5, x = -.15, y = .05) +\n  draw_plot(p2, width = 3, x = 5, y = .01) +\n  draw_label(\n    \"Perú: Pocas instituciones de Administración Pública\\nGastaron más del 70% de su Presupuesto Público al terminar el año 2021\"\n    , x = .1\n    , y = 1.1\n    , color = \"#E5121A\"\n    , hjust = 0\n    , size = 20\n    , fontface = \"bold\"\n    # , familyface = \"bold\"\n  ) +\n  draw_line(\n    x = c(0.1, 8.9)\n    , y = rep(1.19, 2)\n    , color = \"#E5121A\"\n  ) +\n  draw_line(\n    x = c(0.1, .7)\n    , y = rep(1.175, 2)\n    , color = \"#E5121A\"\n    , size = 7\n  ) +\n  draw_label(\n    \"Nota *: Color blanco representa datos faltantes\"\n    , x = 6.5\n    , y = .1\n    , size = 11\n    , color = \"grey50\"\n  ) +\n  draw_label(\n    \"Source: Ministerio de Economía y Finanzas - Perú\\nJhon Kevin (@jhonkevinflore1)\"\n    , x = .1\n    , y = .05\n    , size = 11\n    , hjust = 0\n    , color = \"grey50\"\n  )  +\n  theme(\n    plot.background = element_rect(\"white\", color = NA)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\n  'plots/day12_dcc_22.png'\n  , height = 8\n  , width = 12\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::include_graphics('plots/day12_dcc_22.png')\n```\n\n::: {.cell-output-display}\n![](plots/day12_dcc_22.png){width=1800}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}