{
  "hash": "a0582b0d013dde6f967ffb0a9891385b",
  "result": {
    "markdown": "---\ntitle: \"Day 23\" \ndate: '2022-04-23'\nimage: plots/day23_dcc_22.gif\ncategories:\n  - Data Viz \n  - ggplot2\n  - Data analysis\ndescription: 'Day 23 from #30dataChartChallenge'\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::include_graphics('plots/day23_dcc_22.png')\n```\n\n::: {.cell-output-display}\n![](plots/day23_dcc_22.png){width=1800}\n:::\n:::\n\n\n## Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrarian::shelf(\n  tidyverse\n  , PeruData\n)\nstri_enc_toutf8()\ngasto <- \n  read_csv(here::here(\"data\", \"mef\", \"gasto.csv\")) |> \n  janitor::clean_names() \n\n# map(.x = names(gasto), ~unique(gasto[.x]))\n\n\n# glimpse(gasto)\n\n\nset.seed(12)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(scipen = 999)\n\ngast <- \n  gasto |>\n  filter(str_detect(nivel_gobierno, \"EMPRE\") & str_detect(desc_pliego, \"NACION$\")) |> \n  rename(anio = ano_eje) |> \n  arrange(anio) \n\n# map(.x = names(gast), ~unique(gast[.x]))\navance <- colorRampPalette(c(\"#E5121A\", \"#b3c6d6\", \"#01396b\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np <- \n  gast |> \n  select(anio, desc_pliego, departamento:ejecucion) |> \n  mutate(\n    p = ejecucion / pim \n    , anio = factor(anio, unique(gast$anio))\n    , departamento = ifelse(str_detect(departamento, \"CALLAO\"), \"CALLAO\", departamento) |> str_to_sentence()\n    , departamento = fct_reorder2(departamento, anio, -p)\n    \n    ) |> \n  filter(\n    # p < 2, \n    anio != 2015\n    ) |> \n  ggplot() +\n  aes(anio, departamento, fill = p) +\n  geom_tile(color = \"grey90\") +\n  labs(\n    x = \"\"\n    , y = \"\"\n    , title = \"Perú - Ejecución del presupuesto\"\n    , subtitle = \"Empresa Pública: Banco de la Nación\"\n    , caption = \"#30DayChartChallenge | Day 23: Tiles\\nData: MEF |  @JhonKevinFlore1\"\n    , fill = \"( % )\"\n  ) +\n  annotate(\n    \"segment\"\n    , x = 1\n    , y = 9\n    , xend = 5.8\n    , yend =17 \n    , color = \"black\"\n  ) +\n  annotate(\n    \"segment\"\n    , x = 4\n    , y = 9\n    , xend = 5.8\n    , yend =17 \n    , color = \"black\"\n  ) +\n  annotate(\n    \"label\"\n    , label = \"> 5\"\n    , x = 5.7\n    , y = 17\n    , fill = \"darkblue\"\n    , color = \"white\"\n  ) +\n  scale_fill_gradientn(colours = avance(30)) +\n  theme(\n    plot.background = element_rect(\"#f9f3f2\")\n    , legend.position = c(.97, .5)\n    , panel.grid.major = element_blank()\n    # , panel.grid.major.x = element_line(linetype = 4, color = \"gray60\")\n    , plot.caption = element_text(hjust = .5, color = \"grey50\", size = 12)\n    , plot.title = element_text(hjust = .5, size = 18, face = \"bold\")\n    , plot.subtitle = element_text(hjust = -.15, color = \"#01396b\", size = 15, face = \"bold\")\n    , panel.background = element_rect(\"#f9f3f2\")\n    , legend.background = element_blank()\n    , plot.margin = margin(.6, 1.2, .3, .3, unit = \"cm\")\n    # , legend.text = element_text(size = 16)\n    # , legend.key.width = unit(22, \"mm\")\n  )\n\nggsave(\n  'plots/day23_dcc_22.png'\n  , plot = p\n  , width = 12\n  , height = 8\n)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}