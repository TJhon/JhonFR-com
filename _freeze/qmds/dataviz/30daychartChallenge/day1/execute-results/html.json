{
  "hash": "93785058cc4b11fb9db0b09c4787d2c8",
  "result": {
    "markdown": "---\ntitle: \"Day 01\" \ndate: '2022-04-01'\nimage: plot/day1_dcc_22.png\ncategories:\n  - R\n  - Data Viz \n  - sf\n  - ggplot2\ndescription: 'Day 1 form #30datChartChallenge'\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrarian::shelf(\n  PeruData,\n  tidyverse,\n  janitor, \n  ggstream,\n  cowplot\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\n  The 'cran_repo' argument in shelf() was not set, so it will use\n  cran_repo = 'https://cran.r-project.org' by default.\n\n  To avoid this message, set the 'cran_repo' argument to a CRAN\n  mirror URL (see https://cran.r-project.org/mirrors.html) or set\n  'quiet = TRUE'.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'janitor' was built under R version 4.3.1\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'ggstream' was built under R version 4.3.1\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nperu_covid <- PeruData::covid_casos_fallecidos\nperu_covid |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 18\n  fecha      ubigeo departamento provincia   distrito    sexo    pcr    pr    ag\n  <date>     <chr>  <chr>        <chr>       <chr>       <chr> <dbl> <dbl> <dbl>\n1 2022-02-21 010101 amazonas     chachapoyas chachapoyas feme…     2     0     8\n2 2022-02-21 010101 amazonas     chachapoyas chachapoyas masc…     1     0     4\n3 2022-02-21 010110 amazonas     chachapoyas leimebamba  feme…     0     0     3\n4 2022-02-21 010111 amazonas     chachapoyas levanto     masc…     0     0     1\n5 2022-02-21 010201 amazonas     bagua       bagua       feme…     1     0     1\n6 2022-02-21 010202 amazonas     bagua       aramango    feme…     0     0     1\n# ℹ 9 more variables: total_casos <dbl>, criterio_cla_nico <dbl>,\n#   criterio_sinadef <dbl>, criterio_nexo_epidemiola_gico <dbl>,\n#   criterio_investigacia_n_epidemiola_gica <dbl>, criterio_virola_gico <dbl>,\n#   criterio_radiola_gico <dbl>, criterio_serola_gico <dbl>,\n#   total_fallecidos <dbl>\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nperu_prueba <- \n  peru_covid |> \n  select(fecha, sexo, pcr:total_casos) |> \n  filter(lubridate::year(fecha) > 2020) |> \n  mutate(anio = lubridate::year(fecha), mes = lubridate::month(fecha)) |> \n  select(!fecha) |>\n  pivot_longer(!c(anio, mes, sexo, total_casos), names_to = \"prb\") |> \n  group_by(anio, mes, sexo, prb) |> \n  mutate(across(c(total_casos, value), sum)) |> \n  distinct() |> \n  mutate(\n    fecha = paste(anio, mes, \"01\", sep = \"-\")\n    , fecha = lubridate::ymd(fecha)\n    , prb = case_when(\n      prb == \"pr\" ~ \"Prueba rápida\"\n      , prb == \"ag\" ~ 'Prueba de antigeno'\n      , T ~ \"PCR\"\n    )\n    ) |> \n  drop_na() |> \n  ungroup()\nperu_prueba |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 7\n  sexo      total_casos  anio   mes prb                value fecha     \n  <chr>           <dbl> <dbl> <dbl> <chr>              <dbl> <date>    \n1 femenino      2044429  2022     2 PCR                40894 2022-02-01\n2 femenino      2044429  2022     2 Prueba rápida          0 2022-02-01\n3 femenino      2044429  2022     2 Prueba de antigeno 61312 2022-02-01\n4 masculino     1842830  2022     2 PCR                40299 2022-02-01\n5 masculino     1842830  2022     2 Prueba rápida          0 2022-02-01\n6 masculino     1842830  2022     2 Prueba de antigeno 48871 2022-02-01\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npal <- c(\n  \"#595A52\",  \n  \"#C20008\", \n  \"#13AFEF\"\n  # \"#FFB400\", \n  # \"#8E038E\", \n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np <- \n  peru_prueba |>\n  ggplot() +\n  aes(fecha, value, fill = prb) +\n  geom_stream() +\n  # geom_stream_label(aes(label = prb)) +\n  # geom_line(aes(fecha, value, color = prb, group = prb, fill = prb)) +\n  facet_wrap(~sexo, ncol = 1) +\n  scale_fill_manual(values = pal) +\n  labs(fill = \"\", title = \"COVID Perú (2020 - 2022)\", subtitle = \"Casos positivos según prueba realizada\") +\n  guides(\n    fill = guide_legend(\n      direction = \"horizontal\"\n      , title.position = \"top\"\n      , title.hjust = .5\n      , label.hjust = .5\n      , label.position = \"top\"\n      , keywidth = 2.3\n      , keyheight = 1\n    )\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.y = element_blank()\n    , axis.title = element_blank()\n    , legend.position = c(.5, .6)\n    , legend.background = element_rect(fill = \"white\", color = NA)\n    , legend.key.height = unit(.25, \"mm\")\n    , panel.background = element_rect(fill = \"white\", color = NA)\n    , plot.background = element_rect(fill = \"white\", color = NA)\n    , plot.title = element_text(\n      size = 27\n      , face = \"bold\"\n      , hjust = .5\n      , margin = \n    )\n    , plot.subtitle = element_text(\n      size = 20\n      , hjust = .5\n    )\n    , legend.text = element_text(size = 15)\n    , axis.text.x = element_text(size = 15)\n    , panel.grid.major.y = element_blank()\n    , panel.grid.minor.y = element_blank()\n    , panel.grid.major.x = element_line(size = 1, linetype = \"dashed\", color = \"darkblue\")\n    , panel.grid.minor.x = element_blank()\n    , strip.background = element_blank()\n    , strip.text = element_blank()\n  ) +\n  scale_x_date(date_labels = \"%b - %Y\", date_breaks = \"3 months\") \n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.\nℹ Please use the `linewidth` argument instead.\n```\n:::\n\n```{.r .cell-code}\np\n```\n\n::: {.cell-output-display}\n![](day1_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- \n  ggdraw(p) +\n  cowplot::draw_label(\"Femenino\", x = .74, y = .75, size = 22, color = \"#d17dd8\", fontface = \"bold\") +\n  cowplot::draw_label(\"Masculino\", x = .74, y = .30, size = 22, color = \"#0b4dbf\",fontface = \"bold\") +\n  draw_line(x = c(.34, .72), y = c(.90, .90), size = 28, color = \"white\") +\n  draw_line(x = c(.34, .72), y = c(.485, .485), size = 38, color = \"white\") +\n  draw_label(\"#30DayChartChallenge\\nDay1: Part-to-whole\\nViz: @JhonKevinFlore1\\nData: MINSA Perú\", x = .02, y = .08, hjust = 0)\np1\n```\n\n::: {.cell-output-display}\n![](day1_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np_loc <- paste('plots', 'day1_dcc_22.png', sep = \"/\")\nggsave(\n  plot = p1, \n  p_loc,\n  width = 16, height = 12\n)\nknitr::include_graphics(p_loc)\n```\n\n::: {.cell-output-display}\n![](plots/day1_dcc_22.png){width=2400}\n:::\n:::\n",
    "supporting": [
      "day1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}