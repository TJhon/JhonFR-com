{
  "hash": "1cb808ec7a448375d903837196e62c6f",
  "result": {
    "markdown": "---\ntitle: \"Day 08\" \ndate: '2022-04-08'\nimage: plots/day8_dcc_22.png\ncategories:\n  - R\n  - Data Viz \n  - ggplot2\n  - Data analysis\ndescription: 'Day 8 from #30dataChartChallenge'\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrarian::shelf(\n  ggridges\n  , tidyverse\n  , PeruData\n  , sf\n  , raster\n  , cowplot\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nperu <- \n  raster_peru_alt |> \n  mask(map_peru_depa) |> \n  rasterToPoints() |> \n  as_tibble() |> \n  rename(alt = 3)\n\ndepas <- \n  unique(map_peru_depa$depa)\n\n\nget_alt <- function(dep){\n  depa <- \n    map_peru_depa |> \n    filter(depa == dep)\n  alt <- \n    raster_peru_alt |> \n    mask(depa) |> \n    rasterToPoints() |> \n    as_tibble() |> \n    rename(alt = 3)\n  return(alt)\n}\n\nsierra_map <- \n  map(depas, get_alt)\n\nnames(sierra_map) <- depas\n\nperu_alt <- \n  bind_rows(sierra_map, .id = \"depa\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nalt_cl <- colorRampPalette(c(\"#e5e4d3\", \"#3f2a04\"))\n\np <- \n  ggplot() +\n  geom_tile(data = peru_alt, aes(x, y, fill = alt)) +\n  geom_sf(data = map_peru_depa, aes(geometry = geometry), fill = NA, size = .5, color = \"grey45\") +\n  scale_fill_gradientn(colours = alt_cl(2)) +\n  theme_void() +\n  labs(\n    fill = \"M.S.N.M\"\n  ) +\n  theme(\n    legend.position = c(.2, .2)\n    , legend.background = element_rect(color = \"grey45\")\n    # , legend.box.margin = margin(1, 1, 110, 1, \"pt\")\n    , legend.margin = margin(2, 3, 3, 5, \"mm\")\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlevels_peru <- \n  peru_alt |> \n  group_by(depa) |> \n  # slice(1:200) |> \n  summarise(\n    mean = mean(alt)\n  ) |> \n  filter(depa != \"callao\") |> \n  arrange(mean) |> \n  pull(depa) |> \n  str_to_sentence()\n\np1 <- \n  peru_alt |> \n  filter(depa != \"callao\") |> \n  group_by(depa) |> \n  # slice(1:200) |> \n  mutate(\n    mean = mean(alt)\n    , depa = str_to_sentence(depa)\n    , depa = factor(depa, levels = levels_peru)\n    ) |> \n  ggplot() +\n  aes(alt, str_to_sentence(depa), fill = ..x..) +\n  # geom_density_ridges(\n  #   # jittered_points = T\n  #   position = position_points_jitter(width = .02, yoffset = .25, seed = 1)\n  #   , alpha = .6\n  # ) + \n  geom_density_ridges_gradient(\n    scale = 3, alpha=.3\n    , show.legend = F\n    , color = \"gray50\"\n    , size = .5\n    # , seed\n    ) +\n  # viridis::scale_fill_viridis()\n  scale_fill_gradientn(colours = alt_cl(2)) +\n  theme_minimal() +\n  labs(x = \"\", y = \"\")  +\n  theme(\n    panel.background = element_rect(\"white\")\n    , plot.background = element_rect(\"white\")\n  )\n  \np3 <- \n  ggdraw(xlim = c(0, 4), ylim = c(0, 1)) +\n  draw_plot(p, width = 1.2, x = .2) +\n  draw_plot(p1, width = 2, height = .8, x = 1.7, y = .1) +\n  draw_label(\n    \"Altitud del PerÃº\"\n    , hjust = .5\n    , size = 23\n    , x = 1.7\n    , y = .95\n    , fontface = \"bold\"\n    , fontfamily = \"serif\"\n    , color = \"#664200\"\n    ) +\n  draw_label(\n    \"#30DayChartChallenge\\nDay8: Mountains | Viz: @JhonKevinFlore1\"\n    , x = 1.7\n    , y = .05\n    , hjust = .5\n    , size = 10\n    )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\n  'plots/day8_dcc_22.png'\n  , plot = p3\n  , height = 8\n  , width = 12\n  , bg = \"white\"\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::include_graphics('plots/day8_dcc_22.png')\n```\n\n::: {.cell-output-display}\n![](plots/day8_dcc_22.png){width=1800}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}