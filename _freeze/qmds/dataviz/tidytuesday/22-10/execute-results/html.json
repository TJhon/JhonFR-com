{
  "hash": "f533c3db56ecdda8c5bb152cf5fcc970",
  "result": {
    "markdown": "---\ntitle: \"TidyTuesday 22 / 10\" \ndate: '2022-03-11'\nimage: \"plots/22-10-erasmus.png\"\ncategories:\n  - R\n  - Data Viz \n  - ggplot2\ndescription: '#TidyTuesday 22-10'\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::include_graphics('plots/22-10-erasmus.png')\n```\n\n::: {.cell-output-display}\n![](plots/22-10-erasmus.png){width=1800}\n:::\n:::\n\n\n## Code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrarian::shelf(\n    tidyverse\n    , tidytuesdayR\n    , PeruData\n)\n\ntt <- tidytuesdayR::tt_load(\"2022-03-08\")\nerasmus <-\n    tt$erasmus |>\n    janitor::clean_names()\n\ncc <- read_csv(\"https://gist.githubusercontent.com/tadast/8827699/raw/f5cac3d42d16b78348610fc4ec301e9234f82821/countries_codes_and_coordinates.csv\") |>\n    janitor::clean_names() |>\n    select(1, 2) |>\n    rename(code = 2)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncountry <-\n    erasmus |>\n    filter(\n        academic_year %in% c(\"2018-2019\", \"2019-2020\")\n    ) |>\n    select(\n        participant_nationality\n        , participant_gender\n        , participant_age\n        , receiving_country_code\n        , receiving_city\n        , activity_mob\n        ) |>  #uk\n    mutate(\n        across(\n            c(receiving_country_code, participant_nationality)\n            , ~ifelse(. == \"UK\", \"GB\", .)\n            )\n    ) |>\n    count(\n        receiving_country_code, participant_gender\n    ) |>\n    filter(participant_gender != \"Undefined\") |>\n    with_groups(1, ~mutate(., diff = max(n) - min(n), total = sum(n)), BSM) |>\n    mutate(diff_ap = BBmisc::normalize(diff, method = \"range\", range = c(.1, 1)))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nerasmus_20 <-\n    right_join(cc, country, by = c(\"code\" = \"receiving_country_code\")) |>\n    drop_na(country) |>\n    mutate(\n        country = ifelse(str_detect(country, \"Macedonia\"), \"Macedonia\", country)\n        , country = forcats::fct_reorder(country, total))\nerasmus_20\n\nr_l <-\n    erasmus_20 |>\n    group_by(country) |>\n    arrange(desc(n)) |>\n    top_n(1, n)\nl_l <-\n    erasmus_20 |>\n    group_by(country) |>\n    arrange(desc(n)) |>\n    slice(2)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nerasmus_20 |>\n    ggplot() +\n    aes(country, n) +\n    geom_line(aes(group = country, alpha = diff_ap), size = 1) +\n    geom_point(aes(color = participant_gender), size = 1.5) +\n    geom_text(\n        data = r_l\n        , aes(color = participant_gender, label = n)\n        , size = 3, hjust = -.5\n    ) +\n    geom_text(\n        data = l_l\n        , aes(color = participant_gender, label = n)\n        , size = 3, hjust = 1.5\n    ) +\n    ylim(0, 3400) +\n    scale_color_manual(values = c(\"#c87bd1\", \"#2f4c7f\")) +\n    coord_flip() +\n    labs(\n        x = \"\"\n        , y = \"\"\n        , title = \"Participation in THE ERASMUS\"\n        , subtitle = \"2018 - 2020\"\n        , caption = \"#TidyTuesday-22/10 \\n VIZ: @jhonkevinflore1\"\n        , alpha = \"Diference (%)\"\n        , color = \"Gender\"\n    ) +\n    # theme_roboto()\n    theme_minimal() +\n    theme(\n        panel.background = element_rect(fill = \"#F5F5F5\"),\n        plot.background = element_rect(fill = \"#F5F5F5\"),\n        panel.grid = element_blank(),\n        panel.grid.major.x = element_line(color = \"steelblue2\", linetype = \"dashed\"),\n\n        plot.title = element_text(size = 20, hjust = .5, color = \"steelblue4\", face = \"bold\"),\n        plot.subtitle = element_text(size = 14, color = \"firebrick4\", hjust = 0.5),\n        plot.caption = element_text(color = \"#2f4c7f\", hjust=.5),\n\n        axis.line.x =  element_line(color = \"steelblue2\", size = 0.5),\n        axis.line.y =  element_line(color = \"steelblue2\", size = 0.5),\n        axis.text = element_text(size = 10, color = \"steelblue4\", face = \"bold\"),\n        axis.title = element_text(color = \"steelblue4\", face = \"bold\"),\n\n        # legend.title = element_blank(),\n        legend.justification = c(0, 1),\n        legend.position = c(.54, .25),\n        legend.background = element_blank(),\n        legend.direction=\"horizontal\"\n    )\n\nggsave(here::here(\"plots/22-10-erasmus.png\"), heigh=8, width = 12, unit='in')\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}