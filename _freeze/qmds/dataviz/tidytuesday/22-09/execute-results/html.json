{
  "hash": "375d426b1fc4de6e14bb38941136d285",
  "result": {
    "markdown": "---\ntitle: \"TidyTuesday 22 / 09\" \ndate: '2022-03-04'\nimage: \"plots/22-09-stations.gif\"\ncategories:\n  - R\n  - Data Viz \n  - ggplot2\ndescription: '#TidyTuesday 22-09'\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::include_graphics('plots/22-09-stations.gif')\n```\n\n::: {.cell-output-display}\n![](plots/22-09-stations.gif)\n:::\n:::\n\n\n## Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfont_add_google(\"Quicksand\")\nfont_add_google(\"Fira Sans\")\n\nshowtext::showtext_auto()\n\nf1 <- \"Quicksand\"\nf2 <- \"Fira Sans\"\n\nstations <-\n    tt_load(\"2022-03-01\")$stations |>\n    janitor::clean_names()\n\n\npop <-\n    tibble::tribble(\n  ~pop, ~state,\n  5024279, \"AL\",\n  733391, \"AK\",\n  7151502, \"AZ\",\n  3011524, \"AR\",\n  39538223, \"CA\",\n  5773714, \"CO\",\n  3605944, \"CT\",\n  989948, \"DE\",\n  689545, \"DC\",\n  21538187, \"FL\",\n  10711908, \"GA\",\n  1455271, \"HI\",\n  1839106, \"ID\",\n  12812508, \"IL\",\n  6785528, \"IN\",\n  3190369, \"IA\",\n  2937880, \"KS\",\n  4505836, \"KY\",\n  4657757, \"LA\",\n  1362359, \"ME\",\n  6177224, \"MD\",\n  7029917, \"MA\",\n  10077331, \"MI\",\n  5706494, \"MN\",\n  2961279, \"MS\",\n  6154913, \"MO\",\n  1084225, \"MT\",\n  1961504, \"NE\",\n  3104614, \"NV\",\n  1377529, \"NH\",\n  9288994, \"NJ\",\n  2117522, \"NM\",\n  20201249, \"NY\",\n  10439388, \"NC\",\n  779094, \"ND\",\n  11799448, \"OH\",\n  3959353, \"OK\",\n  4237256, \"OR\",\n  13002700, \"PA\",\n  1097379, \"RI\",\n  5118425, \"SC\",\n  886667, \"SD\",\n  6910840, \"TN\",\n  29145505, \"TX\",\n  3271616, \"UT\",\n  643077, \"VT\",\n  8631393, \"VA\",\n  7705281, \"WA\",\n  1793716, \"WV\",\n  5893718, \"WI\",\n  576851, \"WY\"\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstations10 <-\n    stations |>\n    count(\n        state\n        , fuel_type_code\n        , sort = T\n    ) |>\n    left_join(pop) |>\n    mutate(\n        per10k = (n / pop) *10000\n    ) |>\n    arrange(\n        desc(per10k)\n        , fuel_type_code\n        , state\n    ) |>\n    with_groups(\n        fuel_type_code\n        , ~mutate(\n            .,\n            rk = row_number()\n        )\n    ) |>\n    mutate(\n        fuel =\n            recode(\n                fuel_type_code\n                , \"BD\" = \"Biodiesel (B20 and above)\"\n                , \"CNG\" = \"Copressed Natual Gas\"\n                , \"ELEC\" = \"Electric\"\n                , \"E85\" = \"Ethanol (E85)\"\n                , \"HY\" = \"Hygrogen\"\n                , \"LNG\" = \"Liquiefied Natural Gas\"\n                , \"LPG\" = \"Propane\"\n            )\n    )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nusa_hex <- sf_NPR1to1\nusa_hex_c <- sf_NPR1to1.centers |> PeruData::get_centroid()\n\nstation_fill <- left_join(usa_hex, stations10)\nstation_lbl <- left_join(usa_hex_c, stations10)\n\nfuel <- unique(station_fill$fuel_type_code)\n\ncolor_fuel <-\n  c(\n    \"#af8007\"\n    , \"#dd4f0d\"\n    , \"#7840a0\"\n    , \"#1f33b7\"\n    , \"#0d7c45\"\n    , \"#b22c66\"\n    , \"#0e7070\"\n  )\nnames(color_fuel) <- unique(station_fill$fuel)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nby_state <- function(x){\n  cli::cli_process_start(\"Copute {.val {x}}\")\n\n  usa_sf <-\n    station_fill |>\n    filter(fuel_type_code == x)\n  alt_n <-\n    unique(usa_sf$fuel)\n  my_pal <- colorRampPalette(c(\"#dce5e5\", color_fuel[[alt_n]]))\n  p <-\n    usa_sf |>\n    ggplot() +\n    geom_sf(aes(geometry = geometry, fill = per10k), color = \"white\") +\n    geom_sf(data = sf_NPR1to1, fill = NA, color = \"white\") +\n    geom_text(data = usa_hex_c, aes(x_center, y_center, label = state)) +\n    theme_void() +\n    scale_fill_gradientn(colours = my_pal(2), na.value = \"gray20\") +\n    guides(\n      fill = guide_colorbar(\n        barheight = unit(1.8, units = \"mm\"),\n        barwidth = unit(50, units = \"mm\"),\n        direction = \"horizontal\",\n        ticks.colour = \"grey10\",\n        title.hjust = 0.5\n      )\n    ) +\n    labs(\n      subtitle = glue::glue(\"{alt_n}\")\n      , title = \"Number of stations - per 10k population\"\n      , caption = \"  #TidyTuesday 2022/09\\n  Visualisation: @JhonKevinFlore1\\n\"\n\n    ) +\n    theme(\n      legend.position = c(.5, .8)\n      , plot.title = element_text(hjust = .5, size = 30, family = f2, face = \"bold\")\n      , plot.background = element_rect(fill = \"#94b6ef\", color = NA)\n      , plot.subtitle = element_text(hjust = .5, size = 20, family = f1, color = color_fuel[[alt_n]], face = \"bold\")\n      , plot.caption = element_text(family = f1, lineheight = .3, size = 12, hjust = 0)\n      , legend.title = element_blank()\n      , legend.text = element_text(vjust = 1)\n    )\n  plot(p)\n  cli::cli_process_done()\n}\n\nanimation::saveGIF(\n  {\n    purrr::walk(fuel, by_state)\n  }\n  , movie.name = here::here(\"plots\", \"22-09-stations.gif\")\n  , interval = 2\n  , ani.width = 1210\n  , ani.height = 878\n  , ani.res = 300\n)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}